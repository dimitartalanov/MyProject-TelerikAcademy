import firebaseModule from"firebase-config";import firebaseDb from"firebaseDb";class DbModel{getItems(e,o){return new Promise((l,s)=>{let a=10;o&&"portfolio"===e&&(a+=+o),"blog"===e&&(a=2*+o),firebaseModule.database.child(e).limitToFirst(a).on("value",o=>{if(null==o.val())s(null);else{const s=[];let n=[];for(const l in o.val())"portfolio"===e?s.push(o.val()[l]):"blog"===e&&n.push(o.val()[l]);const t=a-2;n=n.slice(t,a),l({portfolio:s,blog:n})}})})}getById(e,o){return new Promise((l,s)=>{firebaseModule.database.child(e).orderByChild("id").equalTo(o).on("value",e=>{if(null==e.val())s(null);else{let o=[];const s=[];for(const l in e.val()){const a=e.val()[l].comments;for(const e in a)s.push(a[e]);o.push(e.val()[l])}o[0].comments=s,l({blog:o})}})})}saveUserComment(e,o){let l;firebaseDb.onAuthStateChanged(firebaseModule,s=>{s?(l=s.displayName?s.displayName:"anonymuos",firebaseModule.database.child(`blog/${o}/comments`).push({comment:e,userName:l,imgUser:s.photoURL,userId:s.uid})):window.location.href="#/login"})}userProfile(){return new Promise((e,o)=>{firebaseDb.onAuthStateChanged(firebaseModule,l=>{l?firebaseModule.database.child("blog").on("value",s=>{if(null==s.val())o(null);else{const o=[],a=[];for(const e in s.val())o.push(s.val()[e]);o.forEach((e,l)=>{e.comments&&a.push(o[l])});const n=[];for(const e in a){const o=a[e].comments;for(const s in o)o[s].userId===l.uid&&n.push({comment:o[s],id:a[e].id})}const t={userName:l.displayName,userPhoto:l.photoURL,email:l.email,comments:n};e(t)}}):window.location.href="#/login"})})}}const dbModel=new DbModel;export default dbModel;